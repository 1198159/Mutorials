<!-- This is the page to display questions on -->

<!-- ARGUMENTS:
    newQues - question object passed in to be displayed -->

<%- include("../partials/header") -%>
<%- include("../partials/navigation") -%>

<!-- javascript code -->
<script>

    $(document).ready(function () {

        // obtain hidden tag info
        var id = $("#hiddenidtag").text();
        var type = $("#hiddentypetag").text();

        // hide empty response messages
        $("#fr-answerblank").hide();
        $("#mc-answerblank").hide();

        // upon hitting submit button
        var response = "";
        $("#next").click(function () {
            if(type == "mc") {

                // MULTIPLE CHOICE RESPONSE CHECK
                //var choices = document.getElementById("mc-choices").elements;
                var choices = document.querySelectorAll('#mc-choices input[type="radio"]');
                for(let i = 0; i < choices.length; i++) {
                    if(choices[i].checked) {
                        response = choices[i].id;
                    }
                }

                if(response == "") {
                    $("#mc-answerblank").show(1000);
                    //return;
                }
            } else if(type == "sa") {

                // SELECT ALL REPSONSE CHECK
                response = [];
                //var choices = document.getElementById("sa-choices").elements;
                var choices = document.querySelectorAll('#sa-choices input[type="checkbox"]');
                for(let i = 0; i < choices.length; i++) {
                    if(choices[i].checked) {
                        response.push(choices[i].id);
                    }
                }

                if(response.length == 0) {
                    $("#mc-answerblank").show(1000);
                    //return;
                }
            } else if(type == "fr") {

                // FREE RESPONSE RESPONSE CHECK
                response = $("#fr-answer").val();
                
                if(response == "") {
                    $("#fr-answerblank").show(1000);
                    //return;
                }
            }
            
            // NOT POSTING WITH JQUERY; but if we did a post message would go here
        });
    });

</script>

<div class="jumbotron container mt-5">
    
    <h3>Question Info</h3>
    <p>Rating: <%= newQues.rating %></p>
    <p>Source: <%= newQues.ext_source %></p>

    <!-- HIDDEN TAGS -->

    <!-- DISPLAY QUESTION -->
    <% if(newQues.type == "mc") { %>
        <!-- CODE FOR MULTIPLE CHOICE -->
        <h3>Please read the following question and select the best answer:</h3>
        <p><%= newQues.question %></p>
        <form action="/private/checkAnswer" method="POST">
            <div class="mt-4" id="mc-choices">
                <% var choiceIndex = 1; %>
                <% newQues.choices.forEach((choice) => { %>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="answerChoice" id="<%= choiceIndex %>" value="<%= choiceIndex %>">
                        <label class="form-check-label" for="<%= choiceIndex %>"><%= choice %></label>
                    </div>
                    <% choiceIndex++; %>
                <% }) %>
		        <input class="btn btn-primary" type="submit" value="Submit">
            </div>
            <input type="hidden" name="id" value="<%=newQues._id %>">
            <input type="hidden" name="type" value="<%= newQues.type %>">
            <input type="hidden" name="subject" value="<%= subject %>">
            <input type="hidden" name="units" value="<%=units%>">
        </form>
    <% } else if(newQues.type == "sa") { %>
        <!-- CODE FOR<input type="hidden" name="type" value="<%= subject %>"> SELECT ALL  -->
        <h3>Please read the following and select ALL choices that apply:</h3>
        <p><%= newQues.question %></p>
        <form action="/private/checkAnswer" method="POST">
            <div class="mt-4" id="sa-choices">
                <% var choiceIndex = 1; %>
                <% newQues.choices.forEach((choice) => { %>
                    <div class="custom-control custom-checkbox my-1 mr-sm-2">
                        <input type="checkbox" name="saChoice" class="custom-control-input" id="<%= choiceIndex %>" value="<%= choiceIndex %>">
                        <label class="custom-control-label" for="<%= choiceIndex %>"><%= choice %></label>
                    </div>
                    <% choiceIndex++; %>
                <% }) %>
                <input class="btn btn-primary" type="submit" value="Submit">
            </div>
            <input type="hidden" name="id" value="<%=newQues._id %>">
            <input type="hidden" name="type" value="<%= newQues.type %>">
            <input type="hidden" name="subject" value="<%= subject %>">
            <input type="hidden" name="units" value="<%=units%>">
        </form>
    <% } else if(newQues.type == "fr") { %>
        <!-- CODE FOR FREE RESPONSE -->
        <h3>Please read the following question and enter your answer in the box:</h3>
        <p><%= newQues.question %></p>
        <form action="/private/checkAnswer" method="POST">
            <div class="mt-4">
                <div class="form-group">
                    <input type="number" class="form-control" id="fr-answer" placeholder="Enter your answer here" name="freeAnswer">
                </div>
                <input class="btn btn-primary" type="submit" value="Submit">
            </div>
            <input type="hidden" name="id" value="<%=newQues._id %>">
            <input type="hidden" name="type" value="<%= newQues.type %>">
            <input type="hidden" name="subject" value="<%= subject %>">
            <input type="hidden" name="units" value="<%=units%>">
        </form>
    <% } else { %>
        <!-- ERROR CODE -->
        <h3>We are sorry - your question could not be displayed. Please refresh, press "submit", or reenter the trainer.</h3>
    <% } %>


    <h4 class="my-4" id="fr-answerblank"><font color="red">You haven't entered a response yet!</font></h4>
    <h4 class="my-4" id="mc-answerblank"><font color="red">You haven't selected an answer yet!</font></h4>
    
</div>

<%- include("../partials/footer") -%>